<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!--<script src="http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js" type="text/javascript"></script>-->
<script src="http://js.static.yandex.net/jquery/1.3.2/jquery.js" type="text/javascript"></script>
<title></title>
<script type="text/javascript">
    var ometahighlighter2html,
        frame,
        retry = 10;

    $(function(){
        frame = $('<iframe style="display:none" src="ometa-highlighter2html.html"></iframe>').appendTo('body')[0];
    });
    $(function(){
        if (retry) {
            try {
                ometahighlighter2html = frame.contentWindow._OmetaHighlighterToHtml;
                if (!ometahighlighter2html) {
                    throw true;
                } else {
                    $(document).trigger('ready.ometahighlighter2html');
                }
            } catch(e) {
                retry--;
                setTimeout(arguments.callee, 42);
            }
        }
    });

    $(document).bind('ready.ometahighlighter2html', function(){
        $(document).unbind('ready.ometahighlighter2html');

        var t = $('textarea').show().change(function(e){
            //console.time('do');
            $('#res').html(
                ometahighlighter2html(
                    e.target.value,
                    e.target.form.lang.value
                )
            );
            //console.timeEnd('do');
        });
        $('select.lang-select').change(function(e){
            t.val($('#' + this.value).val()).change();
        });
    });
</script>
<link href="tests.css" rel="stylesheet"/>
</head>
<body>
    <form action="">
        <textarea style="display: none; width: 100%; height: 250px;"></textarea>
        <select class="lang-select" name="lang">
            <option value="" selected="selected"></option>
            <option value="js">javascript</option>
        </select>
        <div style="display: none;">
            <textarea id="js">
/**
 * Multiline comments
 * @param {Object} obj Some param
 * @return {Function} Callback
 */
function testFuntion(obj) {
    var res = null;
    var reg = /[^>]/g; // comment
    var string = 'multi\nline' + "doublequote";
    var d = new Date();
    var n = 1 + 2;
    var a = ['1'].concat([2]);
    return res;
}</textarea>
        </div>
    </form>
    <div id="res"></div>
</body>
</html>
